<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta charset="utf-8"> 
	<title>上传稿件</title>
	<link rel="stylesheet" href="css/bootstrap.min.css">
	<script src="js/jquery.min.js"></script>
    <script src="js/jquery.form.js"></script>
	<script src="js/bootstrap.min.js"></script>
</head>

<body>
    <div class="container">
    	<div class="form row" style="text-align:right; margin-right:100px; margin-top:50px; float:right; color:">
            <button id="uploadbtn" type="submit" class="btn btn-success" onClick="documentupload()">提交稿件</button>
        </div>
        <div class="modal fade" id="upload" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document" style="width:50%">
                <div class="modal-content" style="margin-top:10%;">
                    <div class="modal-header">
                    	<button type="button" class="close" data-dismiss="modal" aria-label="Close" aria-hidden="true">&times;</button>
                        <h4 class="modal-title" id="myModalLabel">提交稿件</h4>
                    </div>
                    <div class="modal-body">
                    	<div class="form-horizontal col-md-offset-0" id="update_form">
                            <div class="col-md-12">
                            	<div class="form-group">
                                	<i class="fa fa-user fa-lg"></i>
                                    <label for="name">作者</label>
                                    <label for="name" style="margin-left:13%;">身份证号</label>
                                    <label for="name" style="margin-left:19%;">单位</label>
                                </div>
                                <div class="form-group">
                                	<i class="fa fa-user fa-lg"></i>
                                    <input class="form-control" style="width:15%; float:left;" type="text" placeholder="请输入姓名" id="author1" name="author1" autofocus maxlength="20"/>
                                    <input class="form-control" style="width:25%; float:left; margin-left:2%" type="text" placeholder="请输入身份证号" id="authorid1" name="authorid1" autofocus maxlength="20"/>
                                    <input class="form-control" style="width:40%; float:left; margin-left:2%" type="text" placeholder="请输入单位名称" id="organ1" name="organ1" autofocus maxlength="20"/>
                                    <button id='addbtn' type="submit" class="btn btn-sm" style="margin-left:2%; width:5%;" name="submit" onclick="Add()">+</button>
                                    <button id='subbtn' type="submit" class="btn btn-sm" style="margin-left:2%; width:5%;" name="submit" onclick="Sub()" disabled="disabled">-</button>
                                </div>
                                <div id="add">
                                </div>
                                <form id="infile" method="post" target="frame1" enctype="multipart/form-data" class="form-group">
                                    <i class="fa fa-user fa-lg"></i>
                                    <label for="name">题目</label>
                                    <input class="form-control" type="text" placeholder="请输入稿件题目" id="title" name="title" autofocus maxlength="20"/>
                                	<br />
                                    <i class="fa fa-lock fa-lg"></i>
                                    <label for="name">摘要</label>
                                    <textarea class="form-control" placeholder="请输入摘要，0~200字" id="paperAbstract" name="paperAbstract" autofocus rows="5" cols="20" maxlength="200"></textarea>
                                	<br />
                                    <i class="fa fa-lock fa-lg"></i>
                                    <label for="inputfile">文件输入</label>
                                    <input type="file" name="multipartFile" id="multipartFile">
                                	<br />
                                    <i class="fa fa-lock fa-lg"></i>
                                    <button id='submitbtn' class="btn btn-success" style="float:left;" onclick="upLoad()">提交</button>
                                </form>
                                <iframe style="display:none;" name="frame1" frameborder="0" height="0"></iframe>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
    	</div>
        <div class="modal fade" id="change" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
            <div class="modal-dialog" role="document" style="width:50%">
                <div class="modal-content" style="margin-top:10%;">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel">修改稿件</h4>
                    </div>
                    <div class="modal-body">
                        <div class="form-horizontal col-md-offset-0" id="update_form">
                            <div class="col-md-12">
                            	<div class="form-group">
                                	<i class="fa fa-user fa-lg"></i>
                                    <label for="name">作者</label>
                                    <label for="name" style="margin-left:13%;">身份证号</label>
                                    <label for="name" style="margin-left:19%;">单位</label>
                                </div>
                                <div class="form-group">
                                	<i class="fa fa-user fa-lg"></i>
                                    <input class="form-control" style="width:15%; float:left;" type="text" placeholder="请输入姓名" id="reauthor1" name="reauthor1" autofocus maxlength="20"/>
                                    <input class="form-control" style="width:25%; float:left; margin-left:2%" type="text" placeholder="请输入身份证号" id="reauthorid1" name="reauthorid1" autofocus maxlength="20"/>
                                    <input class="form-control" style="width:40%; float:left; margin-left:2%" type="text" placeholder="请输入单位名称" id="reorgan1" name="reorgan1" autofocus maxlength="20"/>
                                    <button id='readdbtn' type="submit" class="btn btn-sm" style="margin-left:2%; width:5%;" name="submit" onclick="reAdd()">+</button>
                                    <button id='resubbtn' type="submit" class="btn btn-sm" style="margin-left:2%; width:5%;" name="submit" onclick="reSub()" disabled="disabled">-</button>
                                </div>
                                <div id="readd">
                                </div>
                                <form id="refile" method="post" enctype="multipart/form-data" target="frame2" class="form-group">
                                    <i class="fa fa-user fa-lg"></i>
                                    <label for="name">题目</label>
                                    <input class="form-control" type="text" placeholder="请输入稿件题目" id="title" name="title" autofocus maxlength="20"/>
                                	<br />
                                    <i class="fa fa-lock fa-lg"></i>
                                    <label for="name">摘要</label>
                                    <textarea class="form-control" placeholder="请输入摘要，0~200字" id="paperAbstract" name="paperAbstract" autofocus rows="5" cols="20" maxlength="200"></textarea>
                                	<br />
                                    <i class="fa fa-lock fa-lg"></i>
                                    <label for="inputfile">文件输入</label>
                                    <input type="file" name="multipartFile" id="multipartFile">
                                	<br>
                                    <i class="fa fa-lock fa-lg"></i>
                                    <button id='resubmitbtn' class="btn btn-success" onclick="Change()">修改</button>
                                </form>
                                <iframe style="display:none" name="frame2" frameborder="0" height="0"></iframe>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
    	</div>
        <table id="usertable" style="margin-top:12%; text-align:center;" class="table table-striped table-hover">
        </table>
        <table id="meetingtable" style="margin-top:7%; text-align:center;" class="table table-striped table-hover">
        </table>
    </div>
</body>
<script type='text/javascript'>
	var url="http://154.8.211.55:8081";
	var authornum=1;
	var reauthornum=1;
	var UId=1;
	var MId=24;
	var PId;
	//var myDate = new Date();
	//var year = myDate.getFullYear();
	//var month = myDate.getMonth();
	//var day = myDate.getDay();
	$.ajaxSetup({  
    	async:false
	}); 
	var userType = "institution_option";
	if(userType == "user_option")
	{
		userpaperShow();
	}
	else if(userType == "institution_option")
	{
		meetingpaperShow();
	}
	else
	{
		$("#uploadbtn").attr("style","display:none;");
	}
	//if(year<2017)
	//{
		//$("#uploadbtn").attr("disabled",true);
		//$("#uploadbtn").css("background-color","red");
		//$("#uploadbtn").css("border-color","red");
		//document.getElementById("uploadbtn").innerHTML="截止提交";
	//}
	function documentupload()
        {
            $('#upload').modal();
        }
	function paperChange(pid)
        {
            $('#change').modal();
			PId=pid;
        }
	function upLoad()
		{
			var val1 = document.getElementById("author1").value;
			var val2 = document.getElementById("organ1").value;
			var val3 = document.getElementById("title").value;
			var val4 = document.getElementById("paperAbstract").value;		
			var val7 = document.getElementById("authorid1").value;
			var val8 = document.getElementById("multipartFile").value;
			var customizedAuthorList = [];
			for(var i=1;i<=authornum;i++)
			{
				customizedAuthorList.push({"authorName":document.getElementById("author"+i).value,"identificationNumber":document.getElementById("authorid"+i).value,"organization":document.getElementById("organ"+i).value});
			}
			if(val1=="")
			{
				alert("至少有一个作者！");
			}
			else
			{
				if(val7=="")
				{
					alert("身份证号不能为空！");
				}
				else
				{
					if(val3=="")
					{
						alert("稿件题目不能为空！");
					}
					else
					{
						if(val8.length==0)
						{
							alert("上传稿件不能为空！");
						}
						else
						{
							$.post(url+"/paper/author?userId="+UId+"&meetingId="+MId,{"customizedAuthorList":JSON.stringify(customizedAuthorList)},function(data){
								document.getElementById("infile").action=url+"/paper/submission?paperId="+data;
								$("#infile").ajaxForm(function(){
									alert("提交成功！");
									window.location="uploadpaper.html";
								});
							});
						}
					}
				}
			}
		}
	function Change()
		{
			var val1 = document.getElementById("reauthor1").value;
			var val2 = document.getElementById("reorgan1").value;
			var val3 = document.getElementById("title").value;
			var val4 = document.getElementById("paperAbstract").value;	
			var val7 = document.getElementById("reauthorid1").value;
			var val8 = document.getElementById("multipartFile").value;
			var customizedAuthorList = [];
			for(var i=1;i<=reauthornum;i++)
			{
				customizedAuthorList.push({"authorName":document.getElementById("reauthor"+i).value,"identificationNumber":document.getElementById("reauthorid"+i).value,"organization":document.getElementById("reorgan"+i).value});
			}
			if(val1=="")
			{
				alert("至少有一个作者！");
			}
			else
			{
				if(val7=="")
				{
					alert("身份证号不能为空！");
				}
				else
				{
					if(val3=="")
					{
						alert("稿件题目不能为空！");
					}
					else
					{
						if(val8.length==0)
						{
							alert("上传稿件不能为空！");
						}
						else
						{
							$.post(url+"/paper/author?userId="+UId+"&meetingId="+MId,{"customizedAuthorList":JSON.stringify(customizedAuthorList)},function(data){
								document.getElementById("infile").action=url+"/paper/submission?paperId="+data;
								$("#infile").ajaxForm(function(){
									alert("提交成功！");
									window.location="uploaddocument.html";
								});
							});
						}
					}
				}
			}
		}
	function Add()
		{
			authornum++;
			$("#subbtn").attr("disabled",false);
            $("#add").append(
				"<div class='form-group' id='add"+authornum+"'>"+
                "<i class='fa fa-user fa-lg'></i>"+
                "<input class='form-control' style='width:15%; float:left;' type='text' placeholder='请输入姓名' id='author"+authornum+"' name='author"+authornum+"' autofocus maxlength='20'/>"+
				"<input class='form-control' style='width:25%; float:left; margin-left:2%' type='text' placeholder='请输入身份证号' id='authorid"+authornum+"' name='authorid"+authornum+"' autofocus maxlength='20'/>"+
                "<input class='form-control' style='width:40%; float:left; margin-left:2%' type='text' placeholder='请输入单位名称' id='organ"+authornum+"' name='organ"+authornum+"' autofocus maxlength='20'/>"+
                "</div>"
			)
		}
	function Sub()
		{
            $("#add"+authornum).remove();
			authornum--;
			if(authornum==1)
			{
				$("#subbtn").attr("disabled",true);
			}
		}
	function reAdd()
		{
			reauthornum++;
			$("#resubbtn").attr("disabled",false);
            $("#readd").append(
				"<div class='form-group' id='readd"+reauthornum+"'>"+
                "<i class='fa fa-user fa-lg'></i>"+
                "<input class='form-control' style='width:15%; float:left;' type='text' placeholder='请输入姓名' id='reauthor"+reauthornum+"' name='reauthor"+reauthornum+"' autofocus maxlength='20'/>"+
				"<input class='form-control' style='width:25%; float:left; margin-left:2%' type='text' placeholder='请输入身份证号' id='reauthorid"+reauthornum+"' name='reauthorid"+reauthornum+"' autofocus maxlength='20'/>"+
                "<input class='form-control' style='width:40%; float:left; margin-left:2%' type='text' placeholder='请输入单位名称' id='reorgan"+reauthornum+"' name='reorgan"+reauthornum+"' autofocus maxlength='20'/>"+
                "</div>"
			)
		}
	function reSub()
		{
            $("#readd"+reauthornum).remove();
			reauthornum--;
			if(reauthornum==1)
			{
				$("#resubbtn").attr("disabled",true);
			}
		}
	function userpaperShow()
		{
			$("#usertable").append("<caption style='text-align:center;'><h2>投稿录用情况</h2></caption><thead><tr style='height:30px'><td style='width:100px'>投稿编号</td><td style='width:200px'>题目</td><td style='width:400px'>摘要</td><td style='width:100px'>作者</td><td style='width:200px'>单位</td><td style='width:100px'>状态</td><td style='width:100px'>可能操作</td></tr></thead><tbody>");
			$.get(url+"/paper/display?userId="+UId+"&meetingId="+MId,function(data){
            	for(var i=0;i<data.length;i++)
				{
					var splitArray1 = new Array();
					var splitArray2 = new Array();
					var stringname = data[i].names;
					var stringorgan = data[i].organizations;
					var regex = ",";
					splitArray1 = stringname.split(regex);
					splitArray2 = stringorgan.split(regex);
					var namestring = splitArray1.join("<br />");
					var organstring = splitArray2.join("<br />");
					var col = "";
					var t = "";
					if(data[i].status==1)
					{
						t="已录用";
					}
					else if(data[i].status==2)
					{
						t="修改后录用";
					}
					else if(data[i].status==3)
					{
						t="审核中";
					}
					else
					{
						t="未录用";
					}
					if(data[i].status==1)
					{
						col = "green";
					}
					else if(data[i].status==2)
					{
						col = "#F90";
					}
					else if(data[i].status==3)
					{
						col = "gray";
					}
					else
					{
						col = "red";
					}
					$("#usertable").append("<tr><td style='vertical-align:middle;'>"+data[i].paperId+
                    		"</td><td style='vertical-align:middle;'>"+data[i].title+
                            "</td><td style='vertical-align:middle;'>"+data[i].paperAbstract+
							"</td><td style='vertical-align:middle;'>"+namestring+
							"</td><td style='vertical-align:middle;'>"+organstring+
							"</td><td style='vertical-align:middle;'>"+"<font color='"+col+"'>"+t+"</font>"+
							"</td><td style='vertical-align:middle;'>"+"<button id='reloadbtn"+i+"' type='submit' class='btn btn-info btn-sm' name='submit' onClick='paperChange("+data[i].paperId+")'>修改重投</button>"+
                            "</td></tr>")
					if(data[i].status!=2)
					{
						$("#reloadbtn"+i).attr("style","display:none;");
					}
        		}
			}); 
		}
	function meetingpaperShow()
		{
			$("#meetingtable").append("<caption style='text-align:center;'><h2>投稿审核情况</h2></caption><thead><tr style='height:30px'><td style='width:100px'>投稿编号</td><td style='width:200px'>题目</td><td style='width:400px'>摘要</td><td style='width:100px'>作者</td><td style='width:200px'>单位</td><td style='width:100px'>下载</td><td style='width:100px'>审核</td></tr></thead><tbody>");
			$.get(url+"/paper/"+MId,function(data){
            	for(var i=0;i<data.length;i++)
				{
					var splitArray1 = new Array();
					var splitArray2 = new Array();
					var stringname = data[i].names;
					var stringorgan = data[i].organizations;
					var regex = ",";
					splitArray1 = stringname.split(regex);
					splitArray2 = stringorgan.split(regex);
					var namestring = splitArray1.join("<br />");
					var organstring = splitArray2.join("<br />");
					$("#meetingtable").append("<tr><td style='vertical-align:middle;'>"+data[i].paperId+
                    		"</td><td style='vertical-align:middle;'>"+data[i].title+
                            "</td><td style='vertical-align:middle;'>"+data[i].paperAbstract+
							"</td><td style='vertical-align:middle;'>"+namestring+
							"</td><td style='vertical-align:middle;'>"+organstring+
							"</td><td style='vertical-align:middle;'>"+"<button id='downloadbtn"+i+"' class='btn btn-info btn-sm' name='submit'>下载</button>"+
							"</td><td style='vertical-align:middle;'>"+"<button id='checkbtn"+i+"' class='btn btn-success btn-sm' name='submit' onClick='Check("+data[i].paperId+")'>待审核</button>"+
                            "</td></tr>")
					if(data[i].status!=3)
					{
						$("#checkbtn"+i).attr("disabled",true);
						$("#checkbtn"+i).css("background-color","red");
						$("#checkbtn"+i).css("border-color","red");
						document.getElementById("checkbtn"+i).innerHTML = "已审核";
					}
					var downurl = data[i].downloadUrl;
					$("#downloadbtn"+i).click(function(){				
						var $eleForm = $("<form method='get'></form>");
						$eleForm.attr("action",downurl);
						$(document.body).append($eleForm);
						$eleForm.submit();
					});
        		}
			}); 
		}
	function Check(pid)
		{
		}
</script>
</html>
